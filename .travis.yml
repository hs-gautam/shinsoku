{
  "sudo": "required",
  "dist": "trusty",
  "language": "php",
  "cache": {
    "bundler": true,
    "apt": true,
    "directories": [
      "$HOME/.composer/cache",
      "$HOME/.drush/cache",
      "$HOME/.npm"
    ]
  },
  "php": 7,
  "env": "VERSION=HEAD",
  "addons": {
    "apt": {
      "packages": [
        "libappindicator1",
        "fonts-liberation"
      ]
    }
  },
  "before_install": [
    "phpenv config-rm xdebug.ini",
    "composer self-update",
    "composer --version",
    "export DISPLAY=:99.0",
    "sh -e /etc/init.d/xvfb start",
    "sleep 3",
    "LATEST_CHROMEDRIVER=$(wget -q -O - http://chromedriver.storage.googleapis.com/LATEST_RELEASE)",
    "wget http://chromedriver.storage.googleapis.com/$LATEST_CHROMEDRIVER/chromedriver_linux64.zip",
    "unzip chromedriver_linux64.zip",
    "chmod +x chromedriver",
    "mkdir -p $HOME/.composer/vendor/bin",
    "mv -f chromedriver $HOME/.composer/vendor/bin/",
    "rm chromedriver_linux64.zip",
    "export CHROME_BIN=/usr/bin/google-chrome",
    "wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb",
    "sudo dpkg -i google-chrome-stable_current_amd64.deb",
    "rm google-chrome-stable_current_amd64.deb",
    "google-chrome --version"
  ],
  "install": [
    "export PATH=\"$HOME/.composer/vendor/bin:$TRAVIS_BUILD_DIR/bin:$PATH\"",
    "export COMPOSER_EXIT_ON_PATCH_FAILURE=1",
    "mysql -u root -e \"CREATE DATABASE drupal; CREATE USER 'lightning'@'localhost' IDENTIFIED BY 'lightning'; GRANT ALL ON drupal.* TO 'lightning'@'localhost';\"",
    "yes '' | pecl install yaml",
    "echo 'max_execution_time = 120' >> drupal.php.ini;",
    "echo 'sendmail_path = /bin/true' >> drupal.php.ini;",
    "phpenv config-add drupal.php.ini",
    "phpenv rehash",
    "composer global require phing/phing",
    "composer install",
    "phing install -Ddb.database=drupal -Ddb.user=lightning -Ddb.password=lightning -Ddb.host=127.0.0.1 -Durl=http://127.0.0.1:8080",
    "phing recall -Dversion=$VERSION -Ddb.database=drupal -Ddb.user=lightning -Ddb.password=lightning -Ddb.host=127.0.0.1",
    "cd docroot",
    "drupal update:execute"
  ],
  "before_script": [
    "drush runserver --default-server=builtin 8080 &>/dev/null &",
    "jdk_switcher use oraclejdk8",
    "mkdir ../tmp",
    "selenium-server-standalone -port 4444 -log ../tmp/selenium2.log &",
    "sleep 5"
  ],
  "script": [
    "composer validate ./profiles/lightning/composer.json --no-check-all --ansi",
    "phpunit --configuration ./core --group lightning",
    "behat --strict --stop-on-failure --config ./sites/default/files/behat.yml"
  ],
  "group": "stable",
  "os": "linux"
}
